# 로드밸런싱(Load Balancing)이란?

둘 혹은 셋 이상의 중앙처리장치 혹은 저장장치와 같은 컴퓨터 자원들에게 부하(Load), 즉 작업을 나누는 것을 의미

## 로드밸런싱은 왜 필요한가?

- 서버가 하나일 때, 트래픽이 적을 경우 어떠한 문제도 발생하지 않음
- 하지만 사용자가 늘거나 응답이 늘어 트래픽이 감당할 수 없는 정도가 되는 순간 서버는 다운됨

=> 해결 방법이 필요함

#### 1. Vertical Scale-Up

- 가지고 있는 서버 하나의 퍼포먼스 성능을 향상시키는 것
- CPU 코어 수를 늘리거나, RAM을 추가하는 등
- 하나의 서버만 관리하면 되기 때문에 유지보수에 유리
- 아무리 성능을 향상시킨다고 하여도, 하나의 서버이기 때문에 문제가 발생할 경우 전체 서비스가 멈춤. 즉, 서버가 다운된다는 근본적인 문제를 해결하기엔 한계점이 존재함.

#### 2. Horizontal Scale-Out

- 서버의 개수를 늘려 여러 대의 서버를 사용해 트래픽을 해결하는 것
- 즉, 분산시스템을 구축하는 것으로 각 서버에 트래픽을 균등하게 분배하는 **_로드밸런싱_** 이 필요해짐

## 로드밸런싱 알고리즘

### 라운드 로빈 (Round Robin)

- 서버로 들어온 요청을 순서대로 돌아가면서 배정
- 클라이언트의 요청을 순서대로 분배하기 때문에, 모든 서버가 동일한 스펙일 때 적합

### 가중 라운드로빈 (Weighted Round Robin)

- 각 서버마다 가중치를 매겨 가중치가 높은 서버에 요청을 우선적으로 배정
- 서버의 스펙이 상이한 경우, 즉 성능이 달라 트래픽 처리 능력이 다를 때 적합

### 최소 연결 방식

- 클라이언트 요청이 들어온 시점에 가장 적은 연결 상태를 보이는 서버에 배정
- 서버에 분배된 트래픽이 일정하지 않은 경우에 적합 

## 로드밸런싱 종류

### SoftWare VS HardWare
- SW 방식으로 서버를 묶는, 로드밸런싱을 수행하는 것은 단순히 알고리즘만 적용하면되기 때문에 비용이 적음.
- HW는 물리적으로 서버를 묶어 기술을 적용하기 때문에 비용이 비싸지만 안정성이 높고 보안도 유지할 수 있음.

=> 일반적으로 HW 방식 활용

### _L4 로드밸런서_

- OSI 4계층(전송 계층)의 정보를 바탕으로 부하를 분산
- IP 주소, 포트번호, MAC 주소, 전송 프로토콜에 따라 트래픽 분산 가능

**[장점]**
1. 패킷의 내용을 확인하지 않고 분산하므로 빠른 속도와 높은 효율
2. 데이터의 내용을 복호화할 필요가 없기 때문에 안전함
3. L7 로드밸런서보다 저렴한 가격

**[단점]**
1. 패킷의 내용을 살펴볼 수 없으므로 섬세한 라우팅 불가
2. 사용자 IP가 수시로 변경된다면 연속적 서비스 제공 어려움

### _L7 로드밸런서_

- OSI 7계층(응용 계층)에서 로드를 분산
- HTTP 헤더, 쿠키 등 사용자 요청을 기준으로 특정 서버에 트래픽 분산 가능
- L4 로드밸런서 기능에 더해 패킷 내용을 확인하고 그 내용에 따라 특정 서버에 부하 분산 가능

**[장점]**
1. 특정 패턴을 지닌 바이러스 감지해 네트워크 보호 가능
2. 상위 계층에서 분산하기 때문에 섬세한 라우팅 가능
3. 캐싱 기능 제공
4. 비정상적 트래픽 사전에 필터링하여 서비스의 안전성 높음

**[단점]**
1. L4 로드밸런서보다 비쌈
2. 패킷 내용을 복호화하여야 하므로 더 높은 비용
3. 클라이언트↔로드밸런서 서로 인증서를 공유하기 때문에, 공격자가 로드밸런서를 통해 클라이언트 데이터에 접근할 수 있는 보안상의 위험성 존재